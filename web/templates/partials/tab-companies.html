<!-- ===== Entity Browser (shown for multi-type schemas) ===== -->
<div id="entityBrowser" class="hidden">
    <div class="entity-type-bar" id="entityTypeBar">
        <!-- Type buttons rendered by entities.js -->
    </div>
    <div class="entity-breadcrumbs hidden" id="entityBreadcrumbs"></div>
    <div class="entity-controls">
        <input type="text" id="entitySearchInput" placeholder="Search entities... (/)" oninput="debounceEntitySearch()" aria-label="Search entities">
        <button class="btn" onclick="refineSchema()" title="AI schema refinement">Refine Schema</button>
        <button class="primary-btn" onclick="openEntityCreateModal()">+ New</button>
    </div>

    <div id="entityEmptyState" class="entity-empty-state hidden">
        <div class="empty-state-title">No entities yet</div>
        <div class="empty-state-desc">Create your first entity to get started</div>
        <button class="primary-btn" onclick="openEntityCreateModal()">+ Create</button>
    </div>

    <table id="entityTable" class="entity-table">
        <thead id="entityTableHead"></thead>
        <tbody id="entityTableBody"></tbody>
    </table>

    <!-- Entity Bulk Bar -->
    <div id="entityBulkBar" class="bulk-action-bar hidden">
        <span id="entityBulkCount">0 selected</span>
        <button class="btn" onclick="entityBulkAction('star')">Star</button>
        <button class="btn" onclick="entityBulkAction('unstar')">Unstar</button>
        <button class="danger-btn" onclick="entityBulkAction('delete')">Delete</button>
        <button class="btn" onclick="clearEntityBulkSelection()" aria-label="Clear selection">&times;</button>
    </div>

    <!-- Entity Detail Panel -->
    <div id="entityDetailPanel" class="detail-panel hidden"></div>

    <!-- Entity Create/Edit Modal -->
    <div id="entityModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="entityModalTitle"></h2>
            <div id="entityModalBody"></div>
        </div>
    </div>

    <!-- Schema Refinement Panel -->
    <div id="schemaRefinePanel" class="refine-panel hidden"></div>
</div>

<!-- ===== Company View (original, shown for flat schemas) ===== -->
<div id="companyViewWrapper">
<div class="controls">
    <input type="text" id="searchInput" placeholder="Search companies... (/)" oninput="debounceSearch()" aria-label="Search companies">
    <select id="categoryFilter" onchange="addFilterFromSelect('category')" aria-label="Filter by category">
        <option value="">+ Category</option>
    </select>
    <select id="tagFilter" onchange="addFilterFromSelect('tag')" aria-label="Filter by tag">
        <option value="">+ Tag</option>
    </select>
    <select id="geoFilter" onchange="addFilterFromSelect('geography')" aria-label="Filter by geography">
        <option value="">+ Geography</option>
    </select>
    <select id="stageFilter" onchange="addFilterFromSelect('funding_stage')" aria-label="Filter by funding stage">
        <option value="">+ Stage</option>
    </select>
    <select id="relationshipFilter" class="filter-select" onchange="loadCompanies()" aria-label="Filter by relationship">
        <option value="">Relationship</option>
        <option value="any">Any flagged</option>
        <option value="watching">Watching</option>
        <option value="to_reach_out">To Reach Out</option>
        <option value="in_conversation">In Conversation</option>
        <option value="met">Met</option>
        <option value="partner">Partner</option>
        <option value="not_relevant">Not Relevant</option>
    </select>
    <input type="text" id="foundedYearFilter" placeholder="Founded year range..." class="founded-year-filter" readonly aria-label="Filter by founded year">
    <label class="filter-checkbox"><input type="checkbox" id="starredFilter" onchange="loadCompanies()"> Starred</label>
    <label class="filter-checkbox"><input type="checkbox" id="enrichmentFilter" onchange="loadCompanies()"> Needs enrichment</label>
    <button class="filter-action-btn" onclick="openTagManager()" title="Manage tags">Tags</button>
</div>

<!-- Active filters as chips -->
<div id="activeFilters" class="filter-chips-bar hidden"></div>

<!-- Saved views bar -->
<div class="saved-views-bar">
    <select id="savedViewSelect" onchange="loadSavedView()" aria-label="Saved views">
        <option value="">Saved views...</option>
    </select>
    <button class="filter-action-btn" onclick="saveCurrentView()" title="Save current filters">Save view</button>
</div>

<div class="company-view-toggle">
    <button class="view-toggle-btn active" id="viewTableBtn" onclick="switchCompanyView('table')">
        <span class="material-symbols-outlined icon-16">table_rows</span> Table
    </button>
    <button class="view-toggle-btn" id="viewGridBtn" onclick="switchCompanyView('grid')">
        <span class="material-symbols-outlined icon-16">view_list</span> Grid
    </button>
    <button class="view-toggle-btn" id="viewGalleryBtn" onclick="switchCompanyView('gallery')">
        <span class="material-symbols-outlined icon-16">grid_view</span> Gallery
    </button>
    <button class="view-toggle-btn" id="viewTimelineBtn" onclick="switchCompanyView('timeline')">
        <span class="material-symbols-outlined icon-16">timeline</span> Timeline
    </button>
    <button class="view-toggle-btn ml-auto" id="viewExportCsvBtn" onclick="exportTabulatorCsv()" title="Export CSV">
        <span class="material-symbols-outlined icon-16">download</span> CSV
    </button>
</div>

<div id="companyViewContainer" class="hidden"></div>

<!-- Tabulator grid view container -->
<div id="companiesGridContainer" class="hidden"></div>

<table id="companyTable">
    <thead>
        <tr>
            <th class="bulk-header col-bulk"><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this)" title="Select all" aria-label="Select all companies"></th>
            <th class="sort-header col-starred" data-sort="starred"></th>
            <th class="sort-header" data-sort="name">Name</th>
            <th class="sort-header" data-sort="category">Category</th>
            <th>What</th>
            <th>Target</th>
            <th class="sort-header" data-sort="geography">Geo</th>
            <th>Sources</th>
            <th>Tags</th>
            <th class="sort-header" data-sort="confidence">Conf.</th>
        </tr>
    </thead>
    <tbody id="companyBody"></tbody>
</table>

<!-- Bulk Action Bar -->
<div id="bulkActionBar" class="bulk-action-bar hidden">
    <span id="bulkCount">0 selected</span>
    <button class="btn" onclick="bulkAction('assign_category')"><span class="material-symbols-outlined">category</span> Assign Category</button>
    <button class="btn" onclick="bulkAction('add_tags')"><span class="material-symbols-outlined">label</span> Add Tags</button>
    <button class="btn" onclick="bulkAction('set_relationship')"><span class="material-symbols-outlined">handshake</span> Set Relationship</button>
    <button class="btn" onclick="startBatchEnrichment()"><span class="material-symbols-outlined">auto_fix_high</span> Enrich</button>
    <button class="danger-btn" onclick="bulkAction('delete')"><span class="material-symbols-outlined">delete</span> Delete</button>
    <button class="btn" onclick="clearBulkSelection()" aria-label="Clear selection"><span class="material-symbols-outlined">close</span></button>
</div>

<!-- Detail Panel -->
<div id="detailPanel" class="detail-panel hidden">
    <div class="detail-header">
        <h2 id="detailName"></h2>
        <button class="close-btn" onclick="closeDetail()" aria-label="Close detail panel">&times;</button>
    </div>
    <div id="detailContent"></div>
</div>

<!-- Skeleton loading template for company list -->
<template id="skeletonCompanyRow">
  <div class="skeleton-row">
    <div class="skeleton skeleton-avatar"></div>
    <div class="skeleton-content">
      <div class="skeleton skeleton-text medium"></div>
      <div class="skeleton skeleton-text short"></div>
    </div>
  </div>
</template>

<template id="skeletonDetail">
  <div class="skeleton-detail-pad">
    <div class="skeleton skeleton-text long skeleton-text-title"></div>
    <div class="skeleton skeleton-text medium"></div>
    <div class="skeleton skeleton-text long"></div>
    <div class="skeleton skeleton-text short"></div>
    <div class="mt-6">
      <div class="skeleton skeleton-text long"></div>
      <div class="skeleton skeleton-text medium"></div>
    </div>
  </div>
</template>
</div><!-- /companyViewWrapper -->
